<div class="gfm"><div class="highlight highlight-source-cs"><pre><span class="pl-en">T</span> <span class="pl-en">exec</span>&lt;<span class="pl-en">T</span>&gt;(<span class="pl-en">Func</span>&lt;<span class="pl-en">IDbConnection</span>, <span class="pl-en">T</span>&gt; <span class="pl-smi">fn</span>, <span class="pl-en">ScriptScopeContext</span> <span class="pl-smi">scope</span>, <span class="pl-k">object</span> <span class="pl-smi">options</span>)
{
    <span class="pl-k">try</span>
    {
        <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-smi">db</span> <span class="pl-k">=</span> <span class="pl-smi">DbFactory</span>.<span class="pl-en">Open</span>())
        {
            <span class="pl-k">return</span> <span class="pl-en">fn</span>(<span class="pl-smi">db</span>);
        }
    }
    <span class="pl-k">catch</span> (<span class="pl-en">Exception</span> <span class="pl-smi">ex</span>)
    {
        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">StopFilterExecutionException</span>(<span class="pl-smi">scope</span>, <span class="pl-smi">options</span>, <span class="pl-smi">ex</span>);
    }
}

<span class="pl-k">public</span> <span class="pl-k">object</span> <span class="pl-en">dbSelect</span>(<span class="pl-en">ScriptScopeContext</span> <span class="pl-smi">scope</span>, <span class="pl-k">string</span> <span class="pl-smi">sql</span>, <span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt; <span class="pl-smi">args</span>) <span class="pl-k">=&gt;</span> 
    <span class="pl-en">exec</span>(<span class="pl-smi">db</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">db</span>.<span class="pl-en">SqlList</span>&lt;<span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt;&gt;(<span class="pl-smi">sql</span>, <span class="pl-smi">args</span>), <span class="pl-smi">scope</span>, <span class="pl-c1">null</span>);

<span class="pl-k">public</span> <span class="pl-k">object</span> <span class="pl-en">dbSelect</span>(<span class="pl-en">ScriptScopeContext</span> <span class="pl-smi">scope</span>, <span class="pl-k">string</span> <span class="pl-smi">sql</span>, <span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt; <span class="pl-smi">args</span>, <span class="pl-k">object</span> <span class="pl-smi">op</span>) <span class="pl-k">=&gt;</span> 
    <span class="pl-en">exec</span>(<span class="pl-smi">db</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">db</span>.<span class="pl-en">SqlList</span>&lt;<span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt;&gt;(<span class="pl-smi">sql</span>, <span class="pl-smi">args</span>), <span class="pl-smi">scope</span>, <span class="pl-smi">op</span>);


<span class="pl-k">public</span> <span class="pl-k">object</span> <span class="pl-en">dbSingle</span>(<span class="pl-en">ScriptScopeContext</span> <span class="pl-smi">scope</span>, <span class="pl-k">string</span> <span class="pl-smi">sql</span>, <span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt; <span class="pl-smi">args</span>) <span class="pl-k">=&gt;</span>
    <span class="pl-en">exec</span>(<span class="pl-smi">db</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">db</span>.<span class="pl-en">Single</span>&lt;<span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt;&gt;(<span class="pl-smi">sql</span>, <span class="pl-smi">args</span>), <span class="pl-smi">scope</span>, <span class="pl-c1">null</span>);

<span class="pl-k">public</span> <span class="pl-k">object</span> <span class="pl-en">dbSingle</span>(<span class="pl-en">ScriptScopeContext</span> <span class="pl-smi">scope</span>, <span class="pl-k">string</span> <span class="pl-smi">sql</span>, <span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt; <span class="pl-smi">args</span>, <span class="pl-k">object</span> <span class="pl-smi">op</span>) <span class="pl-k">=&gt;</span>
    <span class="pl-en">exec</span>(<span class="pl-smi">db</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">db</span>.<span class="pl-en">Single</span>&lt;<span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt;&gt;(<span class="pl-smi">sql</span>, <span class="pl-smi">args</span>), <span class="pl-smi">scope</span>, <span class="pl-smi">op</span>);</pre></div>
</div>