<div class="gfm"><p>An example of <code>#Script</code> async support is <a href="/docs/introduction#declarative">covered in the Introduction page</a> where <code>await</code>
is implicitly called within an template expression when a script method returns a <code>Task&lt;object&gt;</code>.</p>
<p>The example shows that there's no difference in syntax with calling a script method with a sync or an async <code>Task&lt;object&gt;</code> result,
regardless of whether OrmLite's synchronous or asynchronous <a href="/docs/db-scripts">Database Scripts</a> are used:</p>
<div class="highlight highlight-source-js"><pre>{{ <span class="pl-s"><span class="pl-pds">"</span>select customerId, companyName, city, country from customer where country=@country<span class="pl-pds">"</span></span> <span class="pl-k">|</span><span class="pl-k">&gt;</span> <span class="pl-smi">to</span> <span class="pl-k">=&gt;</span> sql }}
{{ sql <span class="pl-k">|</span><span class="pl-k">&gt;</span> <span class="pl-en">dbSelect</span>({ country<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>UK<span class="pl-pds">'</span></span> }) <span class="pl-k">|</span><span class="pl-k">&gt;</span> <span class="pl-en">take</span>(<span class="pl-c1">3</span>) <span class="pl-k">|</span><span class="pl-k">&gt;</span> textDump }}</pre></div>
<p>For comparisons here's the source code for <code>dbSelect</code> in both the sync <code>DbScripts</code> and async <code>DbScriptsAsync</code>:</p>
<h3>
<a id="user-content-dbscriptscs" class="anchor" href="#dbscriptscs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/src/ServiceStack.OrmLite/DbScripts.cs">DbScripts.cs</a>
</h3>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">object</span> <span class="pl-en">dbSelect</span>(<span class="pl-en">ScriptScopeContext</span> <span class="pl-smi">scope</span>, <span class="pl-k">string</span> <span class="pl-smi">sql</span>, <span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt; <span class="pl-smi">args</span>) <span class="pl-k">=&gt;</span> 
    <span class="pl-en">exec</span>(<span class="pl-smi">db</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">db</span>.<span class="pl-en">SqlList</span>&lt;<span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt;&gt;(<span class="pl-smi">sql</span>, <span class="pl-smi">args</span>), <span class="pl-smi">scope</span>, <span class="pl-c1">null</span>);</pre></div>
<h3>
<a id="user-content-dbscriptsasynccs" class="anchor" href="#dbscriptsasynccs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/src/ServiceStack.OrmLite/DbScriptsAsync.cs">DbScriptsAsync.cs</a>
</h3>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">object</span>&gt; <span class="pl-en">dbSelect</span>(<span class="pl-en">ScriptScopeContext</span> <span class="pl-smi">scope</span>, <span class="pl-k">string</span> <span class="pl-smi">sql</span>, <span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt; <span class="pl-smi">args</span>) <span class="pl-k">=&gt;</span> 
    <span class="pl-en">exec</span>(<span class="pl-smi">db</span> <span class="pl-k">=&gt;</span> <span class="pl-smi">db</span>.<span class="pl-en">SqlListAsync</span>&lt;<span class="pl-en">Dictionary</span>&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt;&gt;(<span class="pl-smi">sql</span>, <span class="pl-smi">args</span>), <span class="pl-smi">scope</span>, <span class="pl-c1">null</span>);</pre></div>
<p>Where if <code>DbScriptsAsync</code> was used <code>#Script</code> will automatically <code>await</code> the result of the async <code>dbSelect</code> method before passing the result to the <code>take</code>
script method.</p>
<h3>
<a id="user-content-manually-handling-async-results" class="anchor" href="#manually-handling-async-results" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Manually handling async results</h3>
<p>Implicit awaiting async <code>Task&lt;object&gt;</code> or <code>Task</code> results only occurs within a template expression, outside of a Template Expression like within a
<a href="/docs/blocks">Script Block</a> Expression or <a href="/docs/syntax#template-literals">template string literal</a> you'll need to manually access the <code>Task</code> result.</p>
<p>When using <code>DbScriptsAsync</code> you'll need to either explicitly access the Task's <code>.Result</code> property or call the <code>.sync()</code> script method
in order to access the sync result:</p>
<div class="highlight highlight-text-html-handlebars"><pre><span class="pl-c1">{{</span><span class="pl-c1">#if</span> <span class="pl-v">sql.dbSelect</span>({ <span class="pl-e"><span class="pl-v">country</span></span>: <span class="pl-s"><span class="pl-pds">'</span>UK<span class="pl-pds">'</span></span> })<span class="pl-e"><span class="pl-v">.Result.Count</span></span> &gt; <span class="pl-e"><span class="pl-v">0</span></span> <span class="pl-c1">}}</span>
    <span class="pl-c1">{{</span> `<span class="pl-e"><span class="pl-v">UK</span></span> <span class="pl-e"><span class="pl-v">Orders</span></span>: ${<span class="pl-e"><span class="pl-v">sql.dbSelect</span></span>({ <span class="pl-e"><span class="pl-v">country</span></span>: <span class="pl-s"><span class="pl-pds">'</span>UK<span class="pl-pds">'</span></span> })<span class="pl-e"><span class="pl-v">.Result.Count</span></span>}` <span class="pl-c1">}}</span>
<span class="pl-c1">{{</span><span class="pl-c1">/if</span><span class="pl-c1">}}</span></pre></div>
<p>Although calling <code>Result</code> or <code>.sync()</code> will synchronously block the async <code>Task</code> result, to <code>await</code> the result instead call the async method within a
template expression before using the awaited async result, e.g:</p>
<div class="highlight highlight-text-html-handlebars"><pre><span class="pl-c1">{{</span> <span class="pl-v">sql</span> |&gt; <span class="pl-e"><span class="pl-v">dbSelect</span></span>({ <span class="pl-e"><span class="pl-v">country</span></span>: <span class="pl-s"><span class="pl-pds">'</span>UK<span class="pl-pds">'</span></span> }) |&gt; <span class="pl-e"><span class="pl-v">to</span></span> =&gt; <span class="pl-e"><span class="pl-v">ukCount</span></span> <span class="pl-c1">}}</span>
<span class="pl-c1">{{</span><span class="pl-c1">#if</span> <span class="pl-v">ukCount</span> &gt; <span class="pl-e"><span class="pl-v">0</span></span> <span class="pl-c1">}}</span>
    <span class="pl-c1">{{</span> `<span class="pl-e"><span class="pl-v">UK</span></span> <span class="pl-e"><span class="pl-v">Orders</span></span>: ${<span class="pl-e"><span class="pl-v">ukCount</span></span>` <span class="pl-c1">}}</span>
<span class="pl-c1">{{</span><span class="pl-c1">/if</span><span class="pl-c1">}}</span></pre></div>
</div>